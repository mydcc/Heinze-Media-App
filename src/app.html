<!doctype html>
<html lang="%lang%">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<!-- Favicons -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.svg" />
	<meta name="theme-color" content="#0a0e27" />

	<script>
		// THEME INITIALIZATION (Prevents FOUC/Flickering)
		// KRITISCH: Override ist IMMER 'auto', Theme wird IMMER nach Route gesetzt
		(function () {
			function getCookie(name) {
				var value = "; " + document.cookie;
				var parts = value.split("; " + name + "=");
				if (parts.length === 2) return parts.pop().split(";").shift();
				return null;
			}

			/**
			 * Theme Resolution: IMMER Route-basiert, auÃŸer wenn manueller Override vorhanden
			 */
			function resolveInitialTheme() {
				// 1. Check for manual override in LocalStorage (set by ThemeSwitcher)
				var manualTheme = localStorage.getItem('hm-theme');
				var override = localStorage.getItem('hm-theme-override') || 'auto';
				
				if (manualTheme && override === 'manual') {
					return manualTheme;
				}

				// 2. Fallback to Route-based Logic
				var pathname = window.location.pathname || '/';
				// Remove trailing slash and split
				var cleanPath = pathname.replace(/\/$/, "");
				var segments = cleanPath.split('/').filter(function (s) { return s.length > 0; });
				var segment = segments[0] || '';

				var themeMap = {
					'': 'steel', 'home': 'steel',
					'about': 'steel', 'contact': 'steel', 'solutions': 'steel',
					'services': 'steel', 'work': 'steel', 'consulting': 'steel',
					'offer': 'insight', 'special': 'insight',
					'metaverse': 'meteorite', 'xr-studio': 'meteorite', 'blog': 'meteorite',
					'free': 'ever',
					'imprint': 'meteorite', 'privacy-policy': 'meteorite',
					'terms': 'meteorite', 'sitemap': 'meteorite'
				};

				return themeMap[segment.toLowerCase()] || 'meteorite';
			}

			var theme = resolveInitialTheme();
			var mode = localStorage.getItem('hm-mode') || getCookie('hm-mode') || 'dark';
			var override = localStorage.getItem('hm-theme-override') || 'auto';

			var doc = document.documentElement;
			doc.className = ''; // Reset classes
			doc.classList.add('theme-' + theme);
			doc.setAttribute('data-mode', mode);
			doc.setAttribute('data-theme-override', override);
			if (mode === 'dark') doc.classList.add('dark');
		})();
	</script>
	%sveltekit.head%
</head>

<body data-sveltekit-preload-data="hover">
	<div style="display: contents">%sveltekit.body%</div>
</body>

</html>